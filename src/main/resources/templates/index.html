<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <title>Product Management</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .category-section { margin-bottom: 3rem; }
        .category-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }
    </style>
</head>
<body>

<div class="container">
    <header class="header">
        <h1>Inventory</h1>
        <div class="header-actions">
            <button onclick="openCategoryModal()" class="btn btn-secondary" style="margin-right: 10px;">
                + New Category
            </button>
            <button onclick="openCreateModal()" class="btn btn-primary">
                + New Product
            </button>
        </div>
    </header>

    <div th:each="category : ${categories}" class="category-section">

        <h2 class="category-title" th:text="${category.name}">Category Name</h2>

        <main class="product-grid">
            <p th:if="${category.products.empty}" style="color: #888;">No products in this category.</p>

            <div th:each="product : ${category.products}" class="product-card">
                <div class="product-info">
                    <h3 th:text="${product.name}" class="product-name"></h3>
                    <span th:text="'$ ' + ${product.price}" class="product-price"></span>
                </div>
                <div class="product-actions">
                    <button class="btn btn-edit"
                            onclick="openEditModal(this)"
                            th:data-id="${product.id}"
                            th:data-name="${product.name}"
                            th:data-price="${product.price}"
                            th:data-cat-id="${product.category != null} ? ${product.category.id} : ''">
                        Edit
                    </button>

                    <form th:action="@{/products/delete/{id}(id=${product.id})}" th:method="delete" style="display:inline;">
                        <button type="submit" class="btn btn-delete" onclick="return confirm('Delete?')">Delete</button>
                    </form>
                </div>
            </div>
        </main>
    </div>
</div>

<div class="modal-overlay hidden" id="product-modal">
    <div class="modal">
        <div class="modal-header">
            <h2 id="product-modal-title">Product Details</h2>
            <button onclick="closeProductModal()" class="close-btn">&times;</button>
        </div>
        <form class="product-form" th:action="@{/products/save}" method="post">
            <input type="hidden" id="id" name="id">

            <div class="form-group">
                <label for="categoryId">Category</label>
                <select id="categoryId" name="category.id" required style="width:100%; padding: 0.75rem;">
                    <option value="" disabled selected>Select a category...</option>
                    <option th:each="cat : ${categories}"
                            th:value="${cat.id}"
                            th:text="${cat.name}">
                    </option>
                </select>
            </div>

            <div class="form-group">
                <label for="name">Product Name</label>
                <input type="text" id="name" name="name" required>
            </div>

            <div class="form-group">
                <label for="price">Price ($)</label>
                <input type="number" id="price" name="price" step="0.01" required>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeProductModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Product</button>
            </div>
        </form>
    </div>
</div>

<div class="modal-overlay hidden" id="category-modal">
    <div class="modal">
        <div class="modal-header">
            <h2>New Category</h2>
            <button onclick="closeCategoryModal()" class="close-btn">&times;</button>
        </div>
        <form class="product-form" th:action="@{/categories/save}" method="post">
            <div class="form-group">
                <label for="catName">Category Name</label>
                <input type="text" id="catName" name="name" placeholder="e.g. Electronics" required>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeCategoryModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Category</button>
            </div>
        </form>
    </div>
</div>

<script src="/script.js"></script>
</body>
</html>